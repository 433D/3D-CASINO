<!DOCTYPE html>
<html>
<head>
<title>賭けフォーム</title>
<script>
  function fetchPlayerData() {
    const id = document.getElementById('playerId').value;
    // スプレッドシートの公開URL
    const spreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1Tq-nGqM-PhpX_tw92zQWhM88_0fNRDp8qdjjmz63a98/edit#gid=594208543';
    const sheetName = 'Sheet1';
    const url = `${spreadsheetUrl}/gviz/tq?tqx=out:json&sheet=${sheetName}&tq=select B,C where A = ${id}`;

    fetch(url)
      .then(response => response.text())
      .then(data => {
        const jsonData = JSON.parse(data.substring(47).slice(0, -2));
        if (jsonData.table.rows.length > 0) {
          const playerName = jsonData.table.rows[0].c[0].v;
          const balance = jsonData.table.rows[0].c[1].v;
          document.getElementById('playerName').textContent = playerName;
          document.getElementById('balance').textContent = balance;
          document.getElementById('betAmount').max = balance - 1000; // 賭け金は所持金未満
        } else {
          document.getElementById('playerName').textContent = 'IDが見つかりません';
          document.getElementById('balance').textContent = '';
          document.getElementById('betAmount').max = 0;
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        document.getElementById('playerName').textContent = 'エラーが発生しました';
        document.getElementById('balance').textContent = '';
        document.getElementById('betAmount').max = 0;
      });
  }

  function submitData() {
    const id = document.getElementById('playerId').value;
    const betTarget = document.getElementById('betTarget').value;
    const betAmount = document.getElementById('betAmount').value;

    // 入力チェック
    if (id === '' || betTarget === '' || betAmount === '') {
      alert('すべての項目を入力してください。');
      return;
    }

    if (betAmount % 1000 !== 0) {
      alert('賭け金は1000の倍数で入力してください。');
      return;
    }

    // Google Apps ScriptのWebアプリケーションURLに置き換える
    const url = 'YOUR_WEB_APP_URL'; // デプロイ後に置き換える

    fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `id=${id}&betTarget=${betTarget}&betAmount=${betAmount}`,
    })
    .then(response => response.text())
    .then(result => {
      alert(result);
    })
    .catch(error => {
      console.error('Error submitting data:', error);
      alert('エラーが発生しました');
    });
  }
</script>
</head>
<body>
  <h1>賭けフォーム</h1>
  <label for="playerId">プレイヤーID (4桁):</label>
  <input type="number" id="playerId" min="1000" max="9999" oninput="fetchPlayerData()">

  <p>プレイヤー名: <span id="playerName"></span></p>
  <p>所持金: <span id="balance"></span></p>

  <label for="betTarget">誰に賭けるか:</label>
  <select id="betTarget">
    <option value="">選択してください</option>
    <option value="Aさん">Aさん</option>
    <option value="Bさん">Bさん</option>
    <option value="Cさん">Cさん</option>
    <option value="Dさん">Dさん</option>
  </select>

  <label for="betAmount">賭ける額 (1000円単位):</label>
  <input type="number" id="betAmount" min="1000" max="0" step="1000">

  <button onclick="submitData()">送信</button>
</body>
</html>