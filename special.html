<!DOCTYPE html>
<html>
<head>
  <title>人間競馬 賭け</title>
  <script>
    function submitBet() {
      // プレイヤーID、賭け金額、賭け対象を取得
      var playerId = document.getElementById("playerId").value;
      var betAmount = document.getElementById("betAmount").value;
      var betTarget = document.getElementById("betTarget").value;

      // 入力値のバリデーション
      if (!playerId || !betAmount || !betTarget) {
        alert("すべての項目を入力してください。");
        return;
      }

      if (betAmount % 1000 !== 0) {
        alert("賭け金は1000円単位で入力してください。");
        return;
      }

      // Google Apps Script の関数を実行
      google.script.run
        .withSuccessHandler(showResult)
        .withFailureHandler(showError) // エラーハンドラを追加
        .recordBet(playerId, betAmount, betTarget, 'https://script.google.com/macros/s/AKfycbwZwNeRB9lRxy-fNGXf5gevLHyjNdB1ErpwHoOJFUS-ByI8PkRbmj1dY-ZR0AyBCe-isw/exec'); // URLを追加
    }

    function showResult(message) {
      alert(message);
      // 結果表示エリアを更新
      google.script.run.withSuccessHandler(updateResult)
        .withFailureHandler(showError) // エラーハンドラを追加
        .getPlayerResult('https://script.google.com/macros/s/AKfycbwZwNeRB9lRxy-fNGXf5gevLHyjNdB1ErpwHoOJFUS-ByI8PkRbmj1dY-ZR0AyBCe-isw/exec'); // URLを追加
    }

    function updateResult(result) {
      document.getElementById("result").innerHTML = 
        "プレイヤー名: " + result.playerName + "<br>" +
        "獲得金額: " + result.dividend + "円<br>" +
        "現在の所持金: " + result.currentBalance + "円";
    }

    // ページ読み込み時にプレイヤー情報と結果を表示
    function initialize() {
      var playerId = document.getElementById("playerId").value;
      if (playerId) {
        google.script.run.withSuccessHandler(updatePlayerInfo)
          .withFailureHandler(showError) // エラーハンドラを追加
          .getPlayerInfo(playerId, 'https://script.google.com/macros/s/AKfycbwZwNeRB9lRxy-fNGXf5gevLHyjNdB1ErpwHoOJFUS-ByI8PkRbmj1dY-ZR0AyBCe-isw/exec'); // URLを追加
        google.script.run.withSuccessHandler(updateResult)
          .withFailureHandler(showError) // エラーハンドラを追加
          .getPlayerResult('https://script.google.com/macros/s/AKfycbwZwNeRB9lRxy-fNGXf5gevLHyjNdB1ErpwHoOJFUS-ByI8PkRbmj1dY-ZR0AyBCe-isw/exec'); // URLを追加
      }
    }

    function updatePlayerInfo(playerInfo) {
      document.getElementById("playerName").value = playerInfo.playerName;
      document.getElementById("currentBalance").value = playerInfo.currentBalance;
    }

    function showError(error) {
      console.error("Error:", error);
      alert("エラーが発生しました: " + error);
    }
  </script>
</head>
<body onload="initialize()">
  <h1>人間競馬 賭け</h1>
  プレイヤーID: <input type="text" id="playerId" oninput="initialize()"><br>
  プレイヤー名: <input type="text" id="playerName" readonly><br>
  現在の所持金: <input type="text" id="currentBalance" readonly><br>
  賭け金額 (1000円単位): <input type="number" id="betAmount"><br>
  賭け対象 (A, B, C, D): <input type="text" id="betTarget"><br>
  <button onclick="submitBet()">賭ける</button>

  <h2>結果</h2>
  <div id="result"></div>
</body>
</html>